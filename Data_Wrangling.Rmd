---
title: "Data Wrangling"
author: "Ben Moolman"
date: "2023-09-05"
output: html_document
---

```{r}
library(tidyverse)
```


```{r}
data <- readr::read_csv("https://raw.githubusercontent.com/JeffSackmann/tennis_atp/master/atp_matches_2023.csv")
```

How to get the pivot longer to work
```{r}
# toy df
cols <- c("p1", "p2",
          "p1_srv_won", "p1_srv_lost",
          "p2_srv_won", "p2_srv_lost")
values <- c("A", "B", 96, 26, 72, 40)
toydf <- data.frame(cols, values) |> pivot_wider(names_from = cols, values_from = values)

# now trying pivot longer to extend columns
toydf |> pivot_longer(cols = c("p1_srv_won", "p2_srv_won"), 
               names_to = "service_point", values_to = "srv_won")

toydf |> pivot_longer(cols = c("p1_srv_won", "p1_srv_lost", "p2_srv_won", "p2_srv_lost"),
                      names_to = "won_point", values_to = "server") |>
  mutate(pt_winner = recode(
    won_point,
    "p1_srv_won" = 1,
    "p1_srv_lost" = 0,
    "p2_srv_won" = 0,
    "p2_srv_lost" = 1)) |>
  select(p1, p2, pt_winner, server)
```


```{r}
columns <- data |> select(1:3,6,9,11,17,19,24,30,32,33,39,41,42,46,48) |> 
  mutate(w_svpt_w = w_1stWon + w_2ndWon,
         w_svpt_l = w_svpt - w_svpt_w,
         l_svpt_w = l_1stWon + l_2ndWon,
         l_svpt_l = l_svpt - l_svpt_w) |>
  select(winner_name, loser_name, w_svpt_w, w_svpt_l, l_svpt_w, l_svpt_l,
         1:5, 7, 9, 16:17)
columns
```

